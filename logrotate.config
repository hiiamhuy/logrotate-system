#!/bin/bash
#
# Log Rotation Configuration File
# Edit this file to set your log and backup locations
#
# Usage: Source this file in your rotation scripts:
#   source ./logrotate.config
#

# ============================================================
# PRIMARY LOG FILE CONFIGURATION
# ============================================================

# Full path to the log file you want to rotate
LOG_FILE="/hw00/d19/x/access_log"

# Directory where the log file is located (automatically derived)
LOG_DIR="$(dirname "$LOG_FILE")"

# ============================================================
# BACKUP/ROTATED LOGS CONFIGURATION
# ============================================================

# Where to store rotated/backup log files
# Options:
#   - Same as LOG_DIR: Backups stay with original log
#   - Custom path: Backups go to separate location
#
# Examples:
#   BACKUP_DIR="$LOG_DIR"                    # Same directory as log
#   BACKUP_DIR="/home/user/log-backups"     # Custom location
#   BACKUP_DIR="$HOME/backups/logs"         # In your home directory

BACKUP_DIR="/home/user/log-backups"

# ============================================================
# ROTATION SETTINGS
# ============================================================

# How many rotated logs to keep (default retention)
DEFAULT_KEEP_COUNT=7

# Maximum log file size in MB (for size-based rotation)
DEFAULT_MAX_SIZE_MB=100

# ============================================================
# ARCHIVE SETTINGS (for rotate-with-archive.sh)
# ============================================================

# Long-term archive directory (separate from recent backups)
ARCHIVE_DIR="$HOME/log-archive"

# Number of recent logs to keep in BACKUP_DIR before moving to archive
ARCHIVE_KEEP_RECENT=7

# Days to keep archived logs before deletion
ARCHIVE_RETENTION_DAYS=90

# ============================================================
# COMPRESSION SETTINGS
# ============================================================

# Compression tool (gzip, bzip2, xz, or none)
COMPRESSION_TOOL="gzip"

# Compression level for gzip (1=fastest, 9=best compression)
GZIP_LEVEL=6

# ============================================================
# NAMING SETTINGS
# ============================================================

# Timestamp format for rotated log filenames
# Examples:
#   %Y%m%d           -> 20241209
#   %Y-%m-%d         -> 2024-12-09
#   %Y%m%d-%H%M%S    -> 20241209-143022
#   %Y-W%U           -> 2024-W49 (week number)
TIMESTAMP_FORMAT="%Y%m%d-%H%M%S"

# ============================================================
# LOGGING
# ============================================================

# Where to log rotation activity (for cron jobs)
ROTATION_LOG="$HOME/logrotate.log"

# ============================================================
# VALIDATION
# ============================================================

# Validate configuration
if [ -z "$LOG_FILE" ]; then
    echo "ERROR: LOG_FILE is not set in configuration"
    exit 1
fi

if [ -z "$BACKUP_DIR" ]; then
    echo "ERROR: BACKUP_DIR is not set in configuration"
    exit 1
fi

# Create backup directory if it doesn't exist
if [ ! -d "$BACKUP_DIR" ]; then
    echo "Creating backup directory: $BACKUP_DIR"
    mkdir -p "$BACKUP_DIR" || {
        echo "ERROR: Cannot create backup directory: $BACKUP_DIR"
        exit 1
    }
fi

# Export variables for use in scripts
export LOG_FILE LOG_DIR BACKUP_DIR
export DEFAULT_KEEP_COUNT DEFAULT_MAX_SIZE_MB
export ARCHIVE_DIR ARCHIVE_KEEP_RECENT ARCHIVE_RETENTION_DAYS
export COMPRESSION_TOOL GZIP_LEVEL TIMESTAMP_FORMAT ROTATION_LOG
